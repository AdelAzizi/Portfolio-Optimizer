# Quantitative Investment System for the Iranian Stock Market

This project is a quantitative investment system designed to analyze the Iranian stock market and identify potential investment opportunities based on various financial factors. It includes tools for data preprocessing, stock screening, portfolio optimization, and backtesting.

## Project Structure

The project is organized into the following directories:

-   `src/`: Contains the core source code of the application.
    -   `factors/`: Scripts for calculating financial factors (e.g., momentum, volatility).
    -   `preprocessor.py`: A script to download, clean, and preprocess historical market data.
    -   `screener_v3_optimized.py`: The main application for screening stocks and optimizing portfolios.
    -   `config.py`: Global configuration parameters for the system.
-   `data/`: Stores the raw and processed data.
    -   `tickers_data/`: Contains the raw historical price data for each stock.
-   `tests/`: Includes all the test files for the application.
-   `analysis/`: Contains scripts and notebooks for research and analysis.
-   `logs/`: Stores log files generated by the application.
-   `cache_v3/`: Caches intermediate data to speed up processing.

## Architectural Overview

The system is designed with a modular architecture that separates data preprocessing from the main analysis and optimization tasks.

1.  **Data Preprocessing (`preprocessor.py`):**
    -   Fetches historical stock data from the Tehran Stock Exchange using the `pytse_client` library.
    -   Cleans and preprocesses the data, handling missing values and ensuring data integrity.
    -   Caches the cleaned data in the `cache_v3/` directory for fast access.

2.  **Factor Calculation (`factors/calculator.py`):**
    -   Computes various financial factors, such as momentum and volatility, from the preprocessed data.

3.  **Stock Screening & Optimization (`screener_v3_optimized.py`):**
    -   Loads the preprocessed data and calculated factors.
    -   Screens stocks based on a multi-factor model that combines momentum and low-volatility.
    -   Optimizes the portfolio of selected stocks to maximize the Sharpe ratio.
    -   Performs backtesting to evaluate the strategy's historical performance.

## Installation

To set up the project, follow these steps:

1.  **Clone the repository:**
    ```bash
    git clone <repository_url>
    cd Portfolio-Optimizer
    ```

2.  **Create a virtual environment:**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows, use `venv\Scripts\activate`
    ```

3.  **Install the required packages:**
    ```bash
    pip install -r requirements_v3.txt
    ```

## Usage

To run the system, execute the following scripts in order:

1.  **Run the preprocessor to download and prepare the data:**
    ```bash
    python src/preprocessor.py
    ```

2.  **Run the screener and optimizer to perform the analysis:**
    ```bash
    python src/screener_v3_optimized.py
    ```

The results, including the optimized portfolio and backtesting analysis, will be displayed in the console and saved to the `logs/` and `cache_v3/` directories.